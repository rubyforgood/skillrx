<%= form_with(model: user, style: "width: 100%;") do |form| %>
  <!-- Error Messages -->
  <% if user.errors.any? %>
    <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 2rem;">
      <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
        <svg style="width: 1.25rem; height: 1.25rem; color: #dc2626;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <h3 style="color: #dc2626; font-weight: 600; margin: 0; font-size: 1rem;">
          <%= pluralize(user.errors.count, "error") %> prohibited this user from being saved:
        </h3>
      </div>
      <ul style="margin: 0; padding-left: 1.5rem; color: #dc2626; font-size: 0.875rem;">
        <% user.errors.each do |error| %>
          <li style="margin-bottom: 0.25rem;"><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Form Fields -->
  <div style="display: grid; gap: 2rem;">

    <!-- Email Field -->
    <div>
      <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 0.75rem; font-size: 0.875rem;">
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <svg style="width: 1rem; height: 1rem; color: #6366f1;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
          Email Address
          <span style="color: #dc2626;">*</span>
        </div>
      </label>
      <%= form.email_field :email,
          style: "width: 100%; padding: 0.875rem 1rem; border: 2px solid #e5e7eb; border-radius: 0.75rem; font-size: 0.875rem; transition: all 0.2s; background: white;",
          placeholder: "Enter email address...",
          autofocus: true,
          required: true,
          onfocus: "this.style.borderColor='#6366f1'; this.style.boxShadow='0 0 0 3px rgba(99, 102, 241, 0.1)'",
          onblur: "this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'" %>
    </div>

    <!-- Password Field -->
    <div>
      <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 0.75rem; font-size: 0.875rem;">
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <svg style="width: 1rem; height: 1rem; color: #6366f1;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
          </svg>
          Password
          <% if !user.persisted? %>
            <span style="color: #dc2626;">*</span>
          <% end %>
        </div>
      </label>
      <%= form.password_field :password,
          style: "width: 100%; padding: 0.875rem 1rem; border: 2px solid #e5e7eb; border-radius: 0.75rem; font-size: 0.875rem; transition: all 0.2s; background: white;",
          placeholder: "Enter password...",
          required: !user.persisted?,
          onfocus: "this.style.borderColor='#6366f1'; this.style.boxShadow='0 0 0 3px rgba(99, 102, 241, 0.1)'",
          onblur: "this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'" %>
      <p style="margin: 0.5rem 0 0 0; color: #6b7280; font-size: 0.75rem;">
        <% if user.persisted? %>
          Leave blank to keep current password
        <% else %>
          Minimum 8 characters required
        <% end %>
      </p>
    </div>

    <!-- Admin Checkbox -->
    <div style="background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 0.75rem; padding: 1.5rem;">
      <div style="display: flex; align-items: start; gap: 1rem;">
        <div style="display: flex; align-items: center; margin-top: 0.125rem;">
          <%= form.check_box :is_admin,
              style: "width: 1.25rem; height: 1.25rem; accent-color: #dc2626; cursor: pointer;" %>
        </div>
        <div style="flex: 1;">
          <label for="<%= form.field_id(:is_admin) %>" style="cursor: pointer; display: block;">
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
              <svg style="width: 1.125rem; height: 1.125rem; color: #dc2626;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.031 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
              </svg>
              <span style="font-weight: 600; color: #374151; font-size: 0.875rem;">Administrator Privileges</span>
            </div>
            <p style="margin: 0; color: #6b7280; font-size: 0.75rem; line-height: 1.5;">
              Grant this user full administrative access including user management, system settings, and all data modification capabilities.
            </p>
          </label>
        </div>
      </div>
    </div>

    <!-- Providers Selection -->
    <div>
      <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 0.75rem; font-size: 0.875rem;">
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <svg style="width: 1rem; height: 1rem; color: #6366f1;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
          </svg>
          Associated Providers
          <span style="color: #dc2626;">*</span>
        </div>
      </label>
      <div  data-controller="select-tags">
        <%= form.select :provider_ids,
                        options_from_collection_for_select(
                          Provider.order(:name),
                          :id,
                          :name,
                          user.providers.ids
            ),
            { prompt: "Select providers", include_blank: false },
            {
              multiple: true,
              data: { "allow-new": "true", "allow-clear": "true", "select-tags-target": "tagList" }
            } %>
        </div>
      <p style="margin: 0.5rem 0 0 0; color: #6b7280; font-size: 0.75rem;">
        Select which providers this user can access and manage content for.
      </p>
    </div>
  </div>

  <!-- Form Actions -->
  <div style="margin-top: 3rem; display: flex; gap: 1rem; justify-content: flex-end; flex-wrap: wrap;">
    <%= link_to users_path,
        style: "background: #f3f4f6; color: #374151; padding: 0.875rem 1.75rem; border-radius: 0.75rem; text-decoration: none; font-weight: 600; font-size: 0.875rem; display: inline-flex; align-items: center; gap: 0.5rem; transition: all 0.2s; border: 1px solid #d1d5db;",
        onmouseover: "this.style.background='#e5e7eb'; this.style.transform='translateY(-1px)'",
        onmouseout: "this.style.background='#f3f4f6'; this.style.transform='translateY(0)'" do %>
      <svg style="width: 1rem; height: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      Cancel
    <% end %>

    <%= form.submit user.persisted? ? "Update User" : "Create User",
        style: "background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 0.875rem 1.75rem; border-radius: 0.75rem; border: none; cursor: pointer; font-weight: 600; font-size: 0.875rem; display: inline-flex; align-items: center; gap: 0.5rem; box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.3); transition: all 0.2s;",
        onmouseover: "this.style.transform='translateY(-2px)'; this.style.boxShadow='0 10px 25px -5px rgba(16, 185, 129, 0.4)'",
        onmouseout: "this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px -1px rgba(16, 185, 129, 0.3)'" %>
  </div>
<% end %>

<style>
  /* Form field focus styles */
  input:focus, select:focus, textarea:focus {
    outline: none !important;
  }

  /* Checkbox styling */
  input[type="checkbox"] {
    border-radius: 0.25rem !important;
  }

  /* Responsive adjustments */
  @media (max-width: 640px) {
    div[style*="justify-content: flex-end"] {
      flex-direction: column !important;
      align-items: stretch !important;
    }

    div[style*="display: flex; align-items: start"] {
      flex-direction: column !important;
      gap: 0.75rem !important;
    }

    div[style*="display: flex; align-items: center; margin-top: 0.125rem"] {
      margin-top: 0 !important;
    }
  }
</style>
